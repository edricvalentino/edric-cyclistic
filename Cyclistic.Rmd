---
title: "Cyclistic"
author: "edricvalentino"
date: "9/1/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval=FALSE)
```

Cyclistic is a bike-share company in Chicago. Cyclistic’s marketing strategy relied on building general awareness and appealing to broad consumer segments. One approach that helped make these things possible was the flexibility of its pricing plans: single-ride passes, full-day passes, and annual memberships. Customers who purchase single-ride or full-day passes are referred to as casual riders. Customers who purchase annual memberships are Cyclistic members. Cyclistic’s finance analysts have concluded that annual members are much more profitable than casual riders. Although the pricing flexibility helps Cyclistic attract more customers, management team believes that maximizing the number of annual members will be key to future growth. In order to design new marketing strategy to convert casual riders into annual member, the team need to better how annual members and casual riders differ.

### Data Usage
Historical trip data from period August 2020 to July 2021 were used to analyze and identify trends.
Note: Cyclistic is a fictional company hence appropriate public dataset were selected to be used in this case study and enable answer the business questions. Data are sourced from [here](https://divvy-tripdata.s3.amazonaws.com/index.html). The data has been made available by Motivate International Inc. under this [license](https://www.divvybikes.com/data-license-agreement).

### Import library packages
The packages used in this analysis are tidyverse, janitor, and lubridate. Tidyverse package was used to handle dataframe, janitor package was used to clean the data, and lubridate package was used to handle dates and times format.
```{r, eval=FALSE}
library(tidyverse)
library(janitor)
library(lubridate)

```

### Import dataset

Historical dataset of 12 months were used in this analysis. Data are sourced from [here](https://divvy-tripdata.s3.amazonaws.com/index.html).
```{r, eval=FALSE} 
aug_2020 <- read_csv('202008-divvy-tripdata.csv')
sep_2020 <- read_csv('202009-divvy-tripdata.csv')
oct_2020 <- read_csv('202010-divvy-tripdata.csv')
nov_2020 <- read_csv('202011-divvy-tripdata.csv')
dec_2020 <- read_csv('202012-divvy-tripdata.csv')
jan_2021 <- read_csv('202101-divvy-tripdata.csv')
feb_2021 <- read_csv('202102-divvy-tripdata.csv')
mar_2021 <- read_csv('202103-divvy-tripdata.csv')
apr_2021 <- read_csv('202104-divvy-tripdata.csv')
may_2021 <- read_csv('202105-divvy-tripdata.csv')
jun_2021 <- read_csv('202106-divvy-tripdata.csv')
jul_2021 <- read_csv('202107-divvy-tripdata.csv')
```
Raw data are in csv format. Function `read_csv` from `tidyverse` package was used to read the csv files so R can work with them. 
Each file contains 13 rows which are:

1.  ride_id : Identifier number for each trip
2.  rideable_type : Identify the type of bikes each user use for each trip. Types are classic_bike, docked_bike, and electric_bike.
3.  started_at : start time for each trip. Formatted in DD/MM/YYYY HH:MM:SS.
4.  ended_at : end time for each trip. Formatted in DD/MM/YYYY HH:MM:SS.
5.  start_station_name
6.  start_station_id 
7.  end_station_name
8.  end_station_id
9.  start_lat
10. start_lng
11.  end_lat
12.  end_lng
13.  member_casual : user type, member or casual



### Prepare the data
Each files contains 13 rows and have consistent placement so they can be stacked together without prior cleaning. All the files were stacked into one big data frame named `bike_rides` to make analysis process easier.
```{r, eval=FALSE}
bike_rides <- rbind(aug_2020,sep_2020,oct_2020,nov_2020,dec_2020,jan_2021,feb_2021,mar_2021,apr_2021,may_2021,jun_2021,jul_2021)
```

In order to make analysis easier to comprehend, some column were renamed. Column ride_id renamed to trip_id, rideable_type to bike_type, and member_casual to user_type.

```{r, eval=FALSE}
bike_rides <- bike_rides %>% rename(trip_id=ride_id,
                                bike_type = rideable_type,
                                user_type=member_casual)
```

In this analysis, not all columns of data are needed. Column of start_lat, start_lng, end_lat, end_lng are not needed so they can be removed from `bike_rides`.
```{r, eval=FALSE}
bike_rides <- bike_rides %>% 
  select(-c(start_lat, start_lng, end_lat, end_lng))
```

Converting time format for column started_at and column ended_at from DD/MM/YYYY HH:MM:SS to YYYY-MM-DD HH:MM:SS using lubridate `ymd_hms` function.
```{r,eval=FALSE}
bike_rides$started_at <- lubridate::ymd_hms(bike_rides$started_at)
bike_rides$ended_at <- lubridate::ymd_hms(bike_rides$ended_at)
```

Add columns for start_time and end_time using lubridate `hms` function.
```{r, eval=FALSE}
bike_rides$start_time <- lubridate::hms(bike_rides$started_at)
bike_rides$end_time <- lubridate::hms(bike_rides$ended_at)
```

Add column that list the date, month, day, and year of each ride. This will allow the analysis to aggregate ride data for each month, day, or year.
```{r, eval=FALSE}
bike_rides$date <- as.Date(bike_rides$started_at)  
bike_rides$month <- format(as.Date(bike_rides$date), "%m")
bike_rides$day <- format(as.Date(bike_rides$date), "%d")
bike_rides$year <- format(as.Date(bike_rides$date), "%Y")
bike_rides$day_of_week <- format(as.Date(bike_rides$date), "%A")
```

Further steps of data check were done to bike_rides to ensure integrity of data. After its integrity were ensured, then the analysis move to data processing.

### Process the data

Calculate ride_length for all trips (measured in seconds) using `difftime` function.
```{r}
bike_rides$ride_length <- difftime(bike_rides$ended_at,bike_rides$started_at)
```

To make sure the ride_length is numeric these steps were done. This meant to ensure further analysis wouldn't come to error due to inconsistent formatting.
```{r}
is.factor(bike_rides$ride_length)
bike_rides$ride_length <- as.numeric(as.character(bike_rides$ride_length))
is.numeric(bike_rides$ride_length)
```

Remove bad data. The dataframe includes a few hundred entries when bikes were taken out of docks and checked for quality by the company or length_ride was negative. Just in case wrong steps were taken, this removal assigned to new data frame called `bike_rides_v2` so the analysis can always go back if something went wrong.
```{r}
bike_rides_v2 <- bike_rides[!(bike_rides$start_station_name == "HQ QR" | bike_rides$ride_length<0),]
```

The codes above return the data frame with incomplete rows which was filled by bad data. Remove those rows so further calculation to data frame won't come to error.
```{r}
bike_rides_v2 <- bike_rides_v2 %>% remove_empty("rows")
```

### Descriptive Analysis

After the data thoroughly cleaned, prepared, and processed, the analysis moved to the next step, which for this case was descriptive analysis to understand how user_type differs to one another.

First off, compare number of rides by user_type.
```{r}
bike_rides_v2 %>% count(user_type)
```

Compare how each user_type like their bike_type for the trips.
```{r}
bike_rides_v2 %>% count(bike_type, user_type)
```

Then to have glimpse of trip time range, summarized it using `summary` function.
```{r}
summary(bike_rides_v2$ride_length)
```

Analyze how each user_type, namely member and casual, differ to one another by its ride time. It is done by using average time, median time, maximum time, and minimum time as comparison.
```{r}
#average user ride time by user_type
aggregate(bike_rides_v2$ride_length ~ bike_rides_v2$user_type, FUN = mean)

#median user ride time by user_type
aggregate(bike_rides_v2$ride_length ~ bike_rides_v2$user_type, FUN = median)

#maximum user ride time by user_type
aggregate(bike_rides_v2$ride_length ~ bike_rides_v2$user_type, FUN = max)

#minimum user ride time by user_type
aggregate(bike_rides_v2$ride_length ~ bike_rides_v2$user_type, FUN = min)
```

To better understand the difference, the analysis went further by comparing average trip time each user_type rides by weekday.
```{r}
#average trip time by weekday by user_type
aggregate(bike_rides_v2$ride_length ~ bike_rides_v2$user_type + bike_rides_v2$day_of_week, FUN = mean)
```

Notice how the days are out of order. It can be fixed by defining the correct order using `factor` fuction and apply it to the column.
```{r}
bike_rides_v2$day_of_week <- ordered(bike_rides_v2$day_of_week, levels=c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
```

Then run the code again to expect it to return the days in defined order.
```{r}
aggregate(bike_rides_v2$ride_length ~ bike_rides_v2$user_type + bike_rides_v2$day_of_week, FUN = mean)
```

Analyze ridership data by type and weekday and assign it to variable summary_trip
```{r}
summary_trip <- bike_rides_v2 %>% 
  mutate(weekday = wday(started_at, label = TRUE)) %>%  #creates weekday field using wday()
  group_by(user_type, weekday) %>%  #groups by usertype and weekday
  summarise(number_of_rides = n()							#calculates the number of rides and average duration 
            ,average_duration = mean(ride_length)) %>% 		# calculates the average duration
  arrange(user_type, weekday)
```

Visualize number of rides by user_type.
```{r}
summary_trip %>% ggplot(aes(x = weekday, y = number_of_rides, fill = user_type)) +
  geom_col(position = "dodge")
```
![](C:/Users/Lenovo/iCloudDrive/Edric's Data/Data Analytics/Google DA Certificate/Course 8 - Case Study/Case Study 1 - Cyclistic/Cyclistic/ride_total_by_user.png)


Visualize average ride time by user_type.
```{r}
summary_trip  %>% 
  ggplot(aes(x = weekday, y = average_duration, fill = user_type)) +
  geom_col(position = "dodge")
```
![](C:/Users/Lenovo/iCloudDrive/Edric's Data/Data Analytics/Google DA Certificate/Course 8 - Case Study/Case Study 1 - Cyclistic/Cyclistic/avg_time_by_user.png)

### Export Files

Summary files could be exported for further analysis purposes. It can be done using `write` function.
```{r}
write.csv(summary_trip, file='summary_trip.csv')
```

Then the analysis can move to next step, which are visualizing in another tools if necessary and presenting.
